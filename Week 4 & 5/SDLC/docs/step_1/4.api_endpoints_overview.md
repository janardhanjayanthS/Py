# API Endpoints Overview

## Base URL
`http://127.0.0.1:5001` 

## Authentication
This API uses JWT Bearer token authentication with role-based access control.
```
Authorization: Bearer <your_jwt_token>
```

**User Roles:**
- **STAFF**: Read-only access (GET operations)
- **MANAGER**: Read and write access (GET, POST, PUT, PATCH)
- **ADMIN**: Full access (GET, POST, PUT, PATCH, DELETE)

## 1. Authentication API

### 1.1 User Registration
- **Endpoint**: `POST /user/register` 
- **Description**: Register a new user account

*Request Body:*
```json
{
  "name": "string (required, max 100 characters, unique)",
  "email": "string (required, valid email format, unique)",
  "password": "string (required, min 8 chars, 1 uppercase, 1 lowercase, 1 digit, 1 special character)",
  "role": "string (optional, enum: staff|manager|admin, default: staff)"
}
```

*Success Response:*
- **201 Created**
```json
{
  "status": "success",
  "message": {
    "registered user": {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "role": "staff"
    }
  }
}
```

*Error Responses:*
- **400 Bad Request** - Email already exists
- **400 Bad Request** - Name already exists
- **400 Bad Request** - Invalid email format
- **400 Bad Request** - Weak password
- **422 Unprocessable Entity** - Validation errors

### 1.2 User Login
- **Endpoint**: `POST /user/login` 
- **Description**: Authenticate user and get JWT access token

*Request Body:*
```json
{
  "email": "string (required)",
  "password": "string (required)"
}
```

*Success Response:*
- **200 OK**
```json
{
  "access_tokem": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "Bearer"
}
```

*Error Response:*
- **401 Unauthorized** - Incorrect email or password

## 2. User Management API

### 2.1 Get All Users
- **Endpoint**: `GET /user/all` 
- **Description**: Get all users in the system

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* STAFF, MANAGER, ADMIN

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "admin@example.com",
    "users": [
      {
        "id": 1,
        "name": "John Doe",
        "email": "john@example.com",
        "role": "staff"
      }
    ]
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions

### 2.2 Update User Profile
- **Endpoint**: `PATCH /user/update` 
- **Description**: Update authenticated user's profile

*Headers Required:*
```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

*Required Roles:* MANAGER, ADMIN

*Request Body:*
```json
{
  "name": "string (optional, max 100 characters, unique)",
  "password": "string (optional, same strength requirements as registration)"
}
```

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "update status": "Name updated successfully",
    "updated user detail": {
      "id": 1,
      "name": "Jane Doe",
      "email": "jane@example.com",
      "role": "manager"
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **400 Bad Request** - Name already exists
- **422 Unprocessable Entity** - Validation errors

### 2.3 Delete User
- **Endpoint**: `DELETE /user/delete` 
- **Description**: Delete a user account

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* ADMIN

*Query Parameters:*
- `user_id`: integer (required)

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "admin@example.com",
    "deleted account": {
      "id": 2,
      "name": "Deleted User",
      "email": "deleted@example.com",
      "role": "staff"
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - User not found

## 3. Category Management API

### 3.1 Get All Categories
- **Endpoint**: `GET /category/all` 
- **Description**: Get all product categories

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* STAFF, MANAGER, ADMIN

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "current user's email": "user@example.com",
    "all categories": [
      {
        "id": 1,
        "name": "electronics"
      },
      {
        "id": 2,
        "name": "clothing"
      }
    ]
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions

### 3.2 Get Specific Category
- **Endpoint**: `GET /category` 
- **Description**: Get a specific category by ID

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* STAFF, MANAGER, ADMIN

*Query Parameters:*
- `category_id`: integer (required)

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "requested category": {
      "id": 1,
      "name": "electronics"
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Category not found

### 3.3 Create Category
- **Endpoint**: `POST /category` 
- **Description**: Create a new product category

*Headers Required:*
```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

*Required Roles:* MANAGER, ADMIN

*Request Body:*
```json
{
  "name": "string (required, max 25 characters, unique)",
  "id": "integer (optional, will be auto-generated)"
}
```

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "new category": {
      "id": 3,
      "name": "books"
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **400 Bad Request** - Category name already exists
- **422 Unprocessable Entity** - Validation errors

### 3.4 Update Category
- **Endpoint**: `PUT /category/update` 
- **Description**: Update an existing category

*Headers Required:*
```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

*Required Roles:* MANAGER, ADMIN

*Request Body:*
```json
{
  "id": "integer (required)",
  "name": "string (required, max 25 characters, unique)"
}
```

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "updated category details": {
      "id": 1,
      "name": "updated_category"
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Category not found
- **400 Bad Request** - Category name already exists

### 3.5 Delete Category
- **Endpoint**: `DELETE /category/delete` 
- **Description**: Delete a category

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* ADMIN

*Query Parameters:*
- `category_id`: integer (required)

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "deleted category": {
      "id": 3,
      "name": "books"
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Category not found

## 4. Product Management API

### 4.1 Get Products
- **Endpoint**: `GET /products` 
- **Description**: Get products with optional filtering

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* STAFF, MANAGER, ADMIN

*Query Parameters (Optional):*
- `product_id`: integer - Get specific product
- `category_id`: integer - Get products by category

*Success Response (All Products):*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "user@example.com",
    "all products": [
      {
        "id": 1,
        "name": "Laptop",
        "quantity": 10,
        "price": 999.99,
        "price_type": "regular",
        "category_id": 1
      }
    ]
  }
}
```

*Success Response (Specific Product):*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "user@example.com",
    "product": {
      "id": 1,
      "name": "Laptop",
      "quantity": 10,
      "price": 999.99,
      "price_type": "regular",
      "category_id": 1
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Product not found

### 4.2 Create Product
- **Endpoint**: `POST /products` 
- **Description**: Create a new product

*Headers Required:*
```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

*Required Roles:* MANAGER, ADMIN

*Request Body:*
```json
{
  "name": "string (required, min 5, max 100 characters)",
  "quantity": "integer (required, positive)",
  "price": "float (required, positive)",
  "category_id": "integer (required, must exist)",
  "id": "integer (optional, will be auto-generated)"
}
```

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "manager@example.com",
    "new product": {
      "id": 2,
      "name": "Smartphone",
      "quantity": 25,
      "price": 699.99,
      "price_type": "regular",
      "category_id": 1
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **400 Bad Request** - Invalid category_id
- **422 Unprocessable Entity** - Validation errors

### 4.3 Update Product
- **Endpoint**: `PUT /product` 
- **Description**: Update an existing product

*Headers Required:*
```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

*Required Roles:* MANAGER, ADMIN

*Query Parameters:*
- `product_id`: integer (required)

*Request Body (Partial Update):*
```json
{
  "name": "string (optional, min 5, max 100 characters)",
  "quantity": "integer (optional, positive)",
  "price": "float (optional, positive)",
  "category_id": "integer (optional, must exist)"
}
```

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "manager@example.com",
    "updated product": {
      "id": 1,
      "name": "Updated Laptop",
      "quantity": 15,
      "price": 1099.99,
      "price_type": "regular",
      "category_id": 1
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Product not found
- **400 Bad Request** - Invalid category_id
- **422 Unprocessable Entity** - Validation errors

### 4.4 Delete Product
- **Endpoint**: `DELETE /product` 
- **Description**: Delete a product

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* ADMIN

*Query Parameters:*
- `product_id`: integer (required)

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "admin@example.com",
    "deleted product": {
      "id": 2,
      "name": "Smartphone",
      "quantity": 25,
      "price": 699.99,
      "price_type": "regular",
      "category_id": 1
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Product not found

### 4.5 Update Product Category
- **Endpoint**: `PATCH /product/update_category` 
- **Description**: Update a product's category

*Headers Required:*
```
Authorization: Bearer <jwt_token>
```

*Required Roles:* MANAGER, ADMIN

*Query Parameters:*
- `product_id`: integer (required)
- `category_id`: integer (required)

*Success Response:*
- **200 OK**
```json
{
  "status": "success",
  "message": {
    "user email": "manager@example.com",
    "updated product to electronics category": {
      "id": 1,
      "name": "Laptop",
      "quantity": 10,
      "price": 999.99,
      "price_type": "regular",
      "category_id": 1
    }
  }
}
```

*Error Responses:*
- **401 Unauthorized** - Invalid or missing token
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Product not found
- **404 Not Found** - Category not found

## 5. Health Check

### 5.1 Health Check
- **Endpoint**: `GET /` 
- **Description**: Basic health check endpoint

*Success Response:*
- **200 OK**
```json
{
  "jello": "world"
}
```

## Common Response Format

All endpoints follow a consistent response format:

**Success Response:**
```json
{
  "status": "success",
  "message": {
    // Response data varies by endpoint
  }
}
```

**Error Response:**
```json
{
  "detail": "Error message describing the issue"
}
```

## HTTP Status Codes

- **200 OK** - Successful request
- **201 Created** - Resource created successfully
- **400 Bad Request** - Invalid request data or business logic violation
- **401 Unauthorized** - Authentication required or invalid credentials
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - Resource not found
- **422 Unprocessable Entity** - Validation errors
- **500 Internal Server Error** - Server error

## Notes

- JWT tokens expire after 30 minutes
- All datetime fields are in UTC
- Passwords are hashed using bcrypt
- All sensitive operations require appropriate user roles
- Category names are automatically converted to lowercase
- Product IDs must be positive integers